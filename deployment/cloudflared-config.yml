# Cloudflare Tunnel Configuration for VerifyAI
# Location: ~/.cloudflared/config.yml

# ============================================
# Tunnel 基本設定
# ============================================

# 替換為您的 Tunnel ID
# 執行 `cloudflared tunnel create verifyai` 後會顯示
tunnel: YOUR_TUNNEL_ID

# Cloudflare 認證檔案位置
credentials-file: /home/pi/.cloudflared/YOUR_TUNNEL_ID.json

# ============================================
# Ingress 規則
# ============================================

ingress:
  # 規則 1: 主網域指向本地 Nginx
  - hostname: verifyai.yourdomain.com
    service: http://localhost:80
    originRequest:
      # 禁用 TLS 驗證（因為是本地連接）
      noTLSVerify: true
      # 連接逾時設定
      connectTimeout: 30s
      # 保持連線設定
      keepAliveConnections: 10

  # 規則 2 (選用): Subdomain 指向其他服務
  # - hostname: staging.verifyai.yourdomain.com
  #   service: http://localhost:8080

  # 規則 3 (選用): API endpoint
  # - hostname: api.verifyai.yourdomain.com
  #   service: http://localhost:3000

  # 規則 4 (選用): Webhook endpoint for GitHub
  # - hostname: verifyai.yourdomain.com
  #   path: /webhook
  #   service: http://localhost:9000

  # 預設規則: 必須放在最後，捕捉所有未匹配的請求
  - service: http_status:404

# ============================================
# 進階設定
# ============================================

# 日誌等級: debug, info, warn, error, fatal
loglevel: info

# 傳輸層設定
transport-loglevel: warn

# 重試設定
retries: 5

# 協議設定
protocol: quic

# 禁用自動更新（建議關閉，手動控制版本）
no-autoupdate: true

# ============================================
# 效能調校
# ============================================

# 最大連線數
max-connections: 4

# 是否使用壓縮
compression: true

# ============================================
# 註解說明
# ============================================

# 設定步驟：
# 1. 將 YOUR_TUNNEL_ID 替換為實際的 Tunnel ID
# 2. 將 verifyai.yourdomain.com 替換為您的實際網域
# 3. 確認 credentials-file 路徑正確（使用 whoami 確認用戶名）
# 4. 執行: cloudflared tunnel route dns verifyai verifyai.yourdomain.com
# 5. 啟動 tunnel: cloudflared tunnel run verifyai
#
# 測試指令：
# cloudflared tunnel info verifyai
# cloudflared tunnel run verifyai
#
# 查看 Cloudflare Dashboard:
# https://dash.cloudflare.com/ → Zero Trust → Networks → Tunnels
